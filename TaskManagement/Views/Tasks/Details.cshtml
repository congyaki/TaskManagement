@model TaskManagement.Models.Task.Query.TaskQueryDto

@{
    ViewData["Title"] = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
    DateTime now = DateTime.Now;
    DateTime startDate = Model.StartDate ?? DateTime.Now;
    DateTime endDate = Model.EndDate ?? DateTime.Now;

    int daysRemaining = 0;
    int hoursRemaining = 0;

    if (endDate > now)
    {
        TimeSpan remainingDuration = endDate - now;
        daysRemaining = (int)remainingDuration.TotalDays;
        hoursRemaining = remainingDuration.Hours;
    }

    double progressPercentage = 0;
    if (endDate > startDate)
    {
        TimeSpan totalDuration = endDate - startDate;
        TimeSpan elapsedDuration = now - startDate;
        progressPercentage = (elapsedDuration.TotalMilliseconds / totalDuration.TotalMilliseconds) * 100;
        progressPercentage = Math.Clamp(progressPercentage, 0, 100);
    }
}

<div class="card shadow-lg rounded-15 mb-4">
    <div class="card-body">
        <h4 class="card-title text-muted">THÔNG TIN CÔNG VIỆC</h4>
        <hr />

        <dl class="row">
            <dt class="col-sm-3 text-secondary font-weight-bold">
                @Html.DisplayNameFor(model => model.Title)
            </dt>
            <dd class="col-sm-9 text-dark">
                @Html.DisplayFor(model => model.Title)
            </dd>

            <dt class="col-sm-3 text-secondary font-weight-bold">
                @Html.DisplayNameFor(model => model.StartDate)
            </dt>
            <dd class="col-sm-9 text-dark">
                @Html.DisplayFor(model => model.StartDate)
            </dd>

            <dt class="col-sm-3 text-secondary font-weight-bold">
                @Html.DisplayNameFor(model => model.EndDate)
            </dt>
            <dd class="col-sm-9 text-dark">
                @Html.DisplayFor(model => model.EndDate)
            </dd>

            <dt class="col-sm-3 text-secondary font-weight-bold">
                Tiến trình
            </dt>
            <dd class="col-sm-9">
                <div class="progress" style="height: 20px; width: 50%;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated"
                         role="progressbar"
                         aria-valuenow="@progressPercentage"
                         aria-valuemin="0"
                         aria-valuemax="100"
                         style="width: @progressPercentage%; background-color: #28a745; color: #000">
                        Còn @daysRemaining ngày và @hoursRemaining giờ
                    </div>
                </div>
            </dd>

            <dt class="col-sm-3 text-secondary font-weight-bold">
                @Html.DisplayNameFor(model => model.Priority)
                
            </dt>
            <dd class="col-sm-9 text-dark">
                @* @Html.DisplayFor(model => model.Priority) *@
                @switch (Model.Priority)
                {
                    case 1:
                        <span class="text-danger">Cao</span>
                        break;
                    case 2:
                        <span class="text-warning">Khá cao</span>
                        break;
                    case 3:
                        <span class="text-primary">Trung bình</span>
                        break;
                    case 4:
                        <span class="text-muted">Thấp</span>
                        break;
                    default:
                        <span>Không xác định</span>
                        break;
                }
            </dd>

            <dt class="col-sm-3 text-secondary font-weight-bold">
                @Html.DisplayNameFor(model => model.Description)
            </dt>
            <dd class="col-sm-9 text-dark">
                @Html.DisplayFor(model => model.Description)
            </dd>

            <dt class="col-sm-3 text-secondary font-weight-bold">
                @Html.DisplayNameFor(model => model.Status)
            </dt>
            <dd class="col-sm-9 text-dark">
                @Html.DisplayFor(model => model.Status)
            </dd>

            <dt class="col-sm-3 text-secondary font-weight-bold">
                @Html.DisplayNameFor(model => model.CreatedAt)
            </dt>
            <dd class="col-sm-9 text-dark">
                @Html.DisplayFor(model => model.CreatedAt)
            </dd>

        </dl>
    </div>
</div>

<div class="text-center">
    <a asp-action="Index" class="btn btn-link text-secondary">← Trở về</a>
    <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn-custom">
        <i class="fas fa-edit"></i> Chỉnh sửa
    </a>
</div>
